<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>COFFEHAZE78üèÜ</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;500;700;800&display=swap" rel="stylesheet">

<style>
/* --- VARIABLES --- */
:root {
    --gold: #f1c40f;
    --gold-gradient: linear-gradient(135deg, #f1c40f 0%, #d4ac0d 100%);
    --green: #2ecc71;
    --red: #ff4757;
    --blue: #3498db;
    --bg-black: #080808;
    --card-bg: rgba(20, 20, 20, 0.85);
    --border-light: rgba(255, 255, 255, 0.1);
    --radius-xl: 25px;
}

/* --- BASE --- */
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body {
    margin: 0; padding: 0; min-height: 100vh;
    font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg-black); color: white;
    display: flex; justify-content: center; overflow-x: hidden;
}

.bg-wall {
    position: fixed; inset: 0; z-index: -2;
    background: url("https://print.marcdaviet.com/wp-content/uploads/2020/10/Noire-de-Peuterey-NB-1100x1649.jpg") center/cover no-repeat;
    opacity: 0.4; filter: grayscale(100%);
}

.app-container {
    width: 100%; max-width: 440px;
    padding: 20px 20px 110px 20px;
    position: relative; z-index: 10;
}

/* BOUTON QR CODE EN HAUT */
.qr-header-btn {
    display: block; margin: 0 auto 10px auto;
    background: rgba(255,255,255,0.05); border: 1px solid var(--border-light);
    color: var(--gold); padding: 8px 15px; border-radius: 50px;
    font-size: 11px; font-weight: 700; cursor: pointer; text-transform: uppercase;
}

header { text-align: center; margin: 10px 0 35px 0; }
h1 {
    font-size: 32px; font-weight: 800; margin: 0;
    background: linear-gradient(to bottom, #ffffff 30%, #a0a0a0 100%);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    letter-spacing: -1.5px; text-transform: uppercase;
}
.subtitle { color: var(--gold); font-size: 10px; letter-spacing: 4px; font-weight: 700; margin-top: 8px; opacity: 0.8; }

/* BENTO CARDS */
.grid-menu { display: grid; gap: 18px; }
.card-menu {
    background: var(--card-bg); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
    border: 1px solid var(--border-light); border-radius: var(--radius-xl);
    padding: 22px; display: flex; justify-content: space-between; align-items: center;
    box-shadow: 0 15px 35px rgba(0,0,0,0.4); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
.card-menu:active { transform: scale(0.96); }
.card-menu h3 { margin: 0; font-size: 18px; font-weight: 700; color: #fff; letter-spacing: -0.5px; }
.card-menu p { margin: 4px 0 0 0; font-size: 12px; color: #999; }
.card-icon { width: 50px; height: 50px; background: rgba(255,255,255,0.05); border-radius: 18px; display: flex; align-items: center; justify-content: center; font-size: 22px; }
.b-gold { border-left: 4px solid var(--gold); }
.b-blue { border-left: 4px solid var(--blue); }
.b-red { border-left: 4px solid var(--red); }

/* PRODUCT VIEW */
.product-view { animation: fadeInUp 0.4s ease-out; }
@keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
.product-img { width: 100%; border-radius: 20px; margin-bottom: 25px; border: 1px solid var(--border-light); box-shadow: 0 20px 40px rgba(0,0,0,0.6); }
.sub-product { background: rgba(255,255,255,0.03); border-radius: 20px; padding: 18px; margin-bottom: 18px; border: 1px solid var(--border-light); }
.sub-title { font-size: 15px; font-weight: 700; color: var(--gold); margin-bottom: 12px; text-transform: uppercase; }

/* CHIPS */
.chips-container { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.chip { background: rgba(0,0,0,0.6); border: 1px solid var(--border-light); padding: 16px; border-radius: 16px; color: #fff; font-size: 14px; font-weight: 600; text-align: center; transition: all 0.2s; }
.chip.added { background: var(--green); color: #000; border-color: var(--green); box-shadow: 0 0 15px rgba(46, 213, 115, 0.4); }

/* FOOTER STICKY */
.sticky-footer { position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 400px; background: rgba(15, 15, 15, 0.95); backdrop-filter: blur(20px); border: 1px solid var(--gold); border-radius: 50px; padding: 18px 25px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 10px 40px rgba(0,0,0,0.8); z-index: 100; }

/* MODAL QR CODE */
#qr-modal {
    position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 10000;
    display: none; justify-content: center; align-items: center; backdrop-filter: blur(10px);
}
.modal-content {
    background: #fff; padding: 30px; border-radius: 30px; text-align: center;
    width: 280px; animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
@keyframes pop { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
#qrcode { margin: 20px auto; display: flex; justify-content: center; }
.close-qr { color: #fff; margin-top: 20px; cursor: pointer; font-weight: 700; opacity: 0.6; }

/* PANIER */
.cart-panel { background: var(--card-bg); padding: 25px; border-radius: var(--radius-xl); border: 1px solid var(--border-light); margin-top: 30px; }
.input-field { width: 100%; background: rgba(0,0,0,0.5); border: 1px solid var(--border-light); color: white; padding: 16px; border-radius: 18px; margin-bottom: 12px; font-family: inherit; font-size: 14px; }
.btn-order { width: 100%; padding: 20px; background: var(--gold-gradient); color: black; font-weight: 800; border-radius: 20px; border: none; font-size: 16px; cursor: pointer; box-shadow: 0 10px 25px rgba(241, 196, 15, 0.3); margin-top: 10px; }

#snow { position: fixed; inset: 0; pointer-events: none; z-index: 0; }
.flake { position: absolute; background: white; border-radius: 50%; opacity: 0.5; animation: fall linear infinite; }
@keyframes fall { to { transform: translateY(100vh); } }

#toast { position: fixed; top: 30px; left: 50%; transform: translate(-50%, -200%); background: linear-gradient(135deg, #8e44ad, #d81b60); padding: 14px 30px; border-radius: 50px; font-weight: 700; z-index: 9999; box-shadow: 0 10px 25px rgba(0,0,0,0.5); transition: transform 0.5s cubic-bezier(0.19, 1, 0.22, 1); }
</style>
</head>
<body>

<div class="bg-wall"></div>
<div id="snow"></div>
<div id="toast">Produit ajout√© !</div>

<div id="qr-modal" onclick="closeQR()">
    <div onclick="event.stopPropagation()">
        <div class="modal-content">
            <h3 style="color: #000; margin: 0 0 10px 0; font-size: 18px;">PARTAGER</h3>
            <p style="color: #666; font-size: 12px; margin-bottom: 20px;">Scannez pour acc√©der √† l'application !</p>
            <div id="qrcode"></div>
        </div>
        <p class="close-qr" onclick="closeQR()">Fermer</p>
    </div>
</div>

<div class="app-container" id="app"></div>
<div id="footer-box"></div>

<script>
const tg = window.Telegram.WebApp;
tg.ready(); tg.expand();

// LIEN NETLIFY MIS √Ä JOUR
const APP_URL = "https://nimble-marzipan-57b02a.netlify.app/"; 

// Initialisation du QR Code
const qrcode = new QRCode(document.getElementById("qrcode"), {
    text: APP_URL,
    width: 200,
    height: 200,
    colorDark : "#000000",
    colorLight : "#ffffff",
    correctLevel : QRCode.CorrectLevel.H
});

function openQR() { document.getElementById('qr-modal').style.display = 'flex'; }
function closeQR() { document.getElementById('qr-modal').style.display = 'none'; }

// Neige
setInterval(() => {
    const s = document.getElementById('snow');
    const f = document.createElement('div');
    f.classList.add('flake');
    const size = Math.random()*2+2;
    f.style.width=f.style.height=`${size}px`;
    f.style.left=`${Math.random()*100}vw`;
    f.style.animationDuration=`${Math.random()*4+6}s`;
    s.appendChild(f);
    setTimeout(()=>f.remove(), 10000);
}, 300);

let cart = [];
let userAddress = "";
let deliveryTime = "D√®s que possible";
let view = 'home';

function render() {
    const app = document.getElementById('app');
    const footer = document.getElementById('footer-box');
    
    if(view === 'home') {
        footer.innerHTML = '';
        let cartHtml = '';
        if(cart.length > 0) {
            const total = cart.reduce((a,b)=>a+b.price, 0);
            const promo = total >= 100;
            cartHtml = `
                <div class="cart-panel">
                    <h3 style="margin-top:0; color:var(--gold)">üõí PANIER</h3>
                    <div style="max-height:120px; overflow-y:auto; margin-bottom:20px;">
                        ${cart.map(i => `<div style="display:flex;justify-content:space-between;font-size:14px;padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.05)"><span>${i.name} (${i.gram})</span><b>${i.price}‚Ç¨</b></div>`).join('')}
                    </div>
                    <div style="display:flex;justify-content:space-between;font-weight:800;font-size:20px;margin-bottom:20px;">
                        <span>TOTAL</span><span>${promo ? total-10 : total}‚Ç¨</span>
                    </div>
                    <input class="input-field" placeholder="üìç Ton adresse..." oninput="userAddress=this.value" value="${userAddress}">
                    <select class="input-field" onchange="deliveryTime=this.value">
                        <option value="D√®s que possible">üöÄ D√®s que possible</option>
                        <option value="Entre 18h-19h">üåô Entre 18h-19h</option>
                        <option value="Pr√©ciser en MP">üìÖ Pr√©ciser en MP</option>
                    </select>
                    <button class="btn-order" onclick="order()">VALIDER LA COMMANDE</button>
                    <p onclick="cart=[];render()" style="text-align:center;font-size:11px;color:#555;margin-top:15px;cursor:pointer">Vider le panier</p>
                </div>`;
        }
        
        app.innerHTML = `
            <button class="qr-header-btn" onclick="openQR()">üì≤ PARTAGER / QR CODE</button>
            <header><h1>COFFEHAZE78</h1><div class="subtitle">PREMIUM SELECTION</div></header>
            <div class="grid-menu">
                <div class="card-menu b-gold" onclick="goProduct('JAUNE PATATE üá≤üá¶üî•','https://i.imgur.com/tc39Nya.png',[['3g',10],['6g',20],['10g',30],['18g',50]])">
                    <div><h3>JAUNE PATATE</h3><p>Marocain d'exception</p></div><div class="card-icon">üá≤üá¶</div>
                </div>
                <div class="card-menu b-blue" onclick="goProduct('BEUH STATE üá∫üá∏','https://i.imgur.com/HTKlFpX.png',[['50g',300],['100g',550]])">
                    <div><h3>BEUH STATE</h3><p>Importation USA</p></div><div class="card-icon">üá∫üá∏</div>
                </div>
                <div class="card-menu b-red" onclick="goProduct('PRODUITS PUISSANTS ü•µüîû','https://i.imgur.com/QhnxJ6E.png',[{name:'Frozen üî• ‚ùÑÔ∏è',p:[['2g',20],['5g',50],['10g',90]]},{name:'Static ‚ö°üî•',p:[['2g',10],['4g',20],['10g',50],['25g',100]]},{name:'Piatella üçØüî•',p:[['1g',40]]}])">
                    <div><h3>PUISSANTS üîû</h3><p>Frozen, Static, Piatella</p></div><div class="card-icon">üî•</div>
                </div>
            </div>
            ${cartHtml}`;
    }
}

function goProduct(title, img, items) {
    view = 'product';
    const app = document.getElementById('app');
    const getChips = (name, prices) => prices.map(p => `<div class="chip" onclick="add(this,'${name}','${p[0]}',${p[1]})">${p[0]} - ${p[1]}‚Ç¨</div>`).join('');
    let content = '';
    if(items[0].name) {
        content = items.map(i => `<div class="sub-product"><div class="sub-title">${i.name}</div><div class="chips-container">${getChips(i.name, i.p)}</div></div>`).join('');
    } else {
        content = `<div class="chips-container" style="margin-top:20px;">${getChips(title, items)}</div>`;
    }
    app.innerHTML = `
        <div class="product-view">
            <p onclick="view='home';render()" style="color:var(--gold);font-weight:700;margin-bottom:20px;cursor:pointer">‚¨Ö RETOUR MENU</p>
            <h2 style="text-align:center;letter-spacing:-1px">${title}</h2>
            <img src="${img}" class="product-img">
            ${content}
        </div>`;
    updateFooter();
}

function add(btn, name, gram, price) {
    cart.push({name, gram, price});
    if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
    btn.classList.add('added');
    const old = btn.innerText; btn.innerText = "AJOUT√â ‚úì";
    setTimeout(() => { btn.classList.remove('added'); btn.innerText = old; }, 800);
    const t = document.getElementById('toast');
    t.innerText = `üõí ${name} ajout√©`;
    t.style.transform = "translate(-50%, 0)";
    setTimeout(() => t.style.transform = "translate(-50%, -200%)", 2000);
    updateFooter();
}

function updateFooter() {
    const f = document.getElementById('footer-box');
    if(view === 'home' || cart.length === 0) { f.innerHTML = ''; return; }
    const total = cart.reduce((a,b)=>a+b.price,0);
    f.innerHTML = `<div class="sticky-footer" onclick="view='home';render()">
        <span style="font-size:13px;opacity:0.8">${cart.length} article(s)</span>
        <span style="font-weight:800">VOIR LE PANIER (${total >= 100 ? total-10 : total}‚Ç¨) ‚ûî</span>
    </div>`;
}

function order() {
    if(!userAddress || userAddress.length < 3) { tg.showAlert("üìç Pr√©cise ton adresse !"); return; }
    let m = `üöÄ *COMMANDE COFFEHAZE78*\n\n`;
    cart.forEach(i => m += `‚ñ™Ô∏è ${i.name} (${i.gram}) : ${i.price}‚Ç¨\n`);
    const t = cart.reduce((a,b)=>a+b.price,0);
    const r = t >= 100 ? 10 : 0;
    m += `\nüéÅ REMISE : ${r}‚Ç¨\nüí∞ *TOTAL : ${t-r}‚Ç¨*\n\nüìç ADRESSE : ${userAddress}\nüïí CR√âNEAU : ${deliveryTime}`;
    window.open("https://wa.me/33645681670?text=" + encodeURIComponent(m));
}

render();
</script>
</body>
</html>

