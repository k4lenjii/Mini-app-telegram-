<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>COFFEHAZE78üèÜ</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
/* Reset & Base */
* { box-sizing: border-box; }
body {
  margin:0;
  padding:0;
  min-height:100vh;
  font-family: 'Poppins', sans-serif;
  color:white;
  background: url("https://print.marcdaviet.com/wp-content/uploads/2020/10/Noire-de-Peuterey-NB-1100x1649.jpg") no-repeat center center fixed;
  background-size: cover;
  overflow-x: hidden;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* CONTENEUR NEIGE */
#snow-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 1;
}
.snowflake {
  position: absolute;
  background-color: rgba(255, 255, 255, 0.8);
  border-radius: 50%;
  animation: fall linear infinite;
}
@keyframes fall {
  0% { transform: translateY(-10vh) translateX(0); opacity: 0; }
  10% { opacity: 0.8; }
  100% { transform: translateY(110vh) translateX(50px); opacity: 0; }
}

/* √âCRAN DE CHARGEMENT */
#loading-screen {
    position: fixed;
    inset: 0;
    background: #000;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    transition: opacity 0.5s ease;
}
.loader {
    width: 40px; height: 40px;
    border: 4px solid #333;
    border-top: 4px solid #f1c40f;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

/* NOTIFICATION TOAST (VIOLET/PINK & CENTR√â) */
#toast {
    position: fixed;
    top: 30px;
    left: 50%;
    transform: translateX(-50%) translateY(-200%);
    background: linear-gradient(135deg, #8e44ad, #d81b60); /* D√©grad√© Violet vers Rose */
    min-width: 200px;
    height: 45px; /* Hauteur fixe pour aider au centrage */
    display: flex; /* Flexbox pour le centrage interne */
    align-items: center; /* Centrage vertical */
    justify-content: center; /* Centrage horizontal */
    padding: 0 20px;
    border-radius: 50px;
    font-weight: 600;
    font-size: 14px;
    z-index: 10000;
    transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 8px 25px rgba(216, 27, 96, 0.4);
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

/* L'APPLICATION */
.app {
  position: relative;
  z-index: 10;
  width: 92%;
  max-width: 400px;
  background: rgba(10, 10, 10, 0.92);
  border-radius: 30px;
  padding: 25px;
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255,255,255,0.1);
  box-shadow: 0 20px 40px rgba(0,0,0,0.5);
  margin: 20px auto;
}

h1 { text-align:center; font-size:24px; font-weight:700; margin-bottom:20px; }
h2 { text-align:center; color: #f1c40f; margin-bottom: 20px; }

button {
  width:100%; padding:16px; margin:10px 0;
  border:none; border-radius:18px;
  font-size:16px; font-weight:600;
  font-family: 'Poppins', sans-serif;
  cursor:pointer; color:white;
  transition: transform 0.1s;
}
button:active { transform: scale(0.96); }

.yellow { background: #c9a400; color: #000; }
.darkgreen { background: #1b5e20; }
.red { background: #b71c1c; }
.green { background: #25D366; }
.gray { background: rgba(255,255,255,0.15); }

/* PANIER & PROMO */
.promo-info { font-size: 11px; margin-bottom: 5px; display: block; text-align: center;}
.progress-bar { background: #222; height: 8px; border-radius: 10px; margin-bottom: 15px; overflow: hidden; }
.progress-fill { background: #f1c40f; height: 100%; width: 0%; transition: width 0.5s ease; }

.product-card { background: rgba(255,255,255,0.03); border-radius:25px; padding:15px; }
.product-card img { width:100%; border-radius:20px; margin-bottom:15px; }

.gram-btn {
  padding:10px 14px; border-radius:12px;
  border: 1px solid rgba(255,255,255,0.2);
  background: transparent; color:white;
  font-size: 13px; width: auto;
}

.cart-summary { background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 25px; margin-top: 20px; }

.input-style {
  width: 100%; padding: 14px; margin: 8px 0;
  border-radius: 14px; border: 1px solid rgba(255,255,255,0.1);
  background: #000; color: white;
  font-family: 'Poppins', sans-serif; font-size: 14px;
}
</style>
</head>
<body>

<div id="toast">Ajout√© ! üõí</div>

<div id="loading-screen">
    <div class="loader"></div>
    <p style="margin-top:15px; font-weight:600;">COFFEHAZE78üèÜ</p>
</div>

<div id="snow-container"></div>

<div class="app" id="app"></div>

<script>
const tg = window.Telegram.WebApp;
tg.ready();
tg.expand();

// NEIGE
function createSnowflake() {
  const container = document.getElementById('snow-container');
  if(!container) return;
  const flake = document.createElement('div');
  flake.classList.add('snowflake');
  const size = Math.random() * 3 + 1;
  flake.style.width = size + 'px';
  flake.style.height = size + 'px';
  flake.style.left = Math.random() * 100 + 'vw';
  flake.style.animationDuration = Math.random() * 5 + 5 + 's';
  flake.style.animationDelay = Math.random() * 2 + 's';
  container.appendChild(flake);
  setTimeout(() => flake.remove(), 7000);
}
setInterval(createSnowflake, 250);

// CHARGEMENT
setTimeout(() => {
    const loader = document.getElementById('loading-screen');
    if(loader) {
        loader.style.opacity = '0';
        setTimeout(() => loader.remove(), 500);
    }
}, 1200);

const app = document.getElementById("app");
const WHATSAPP_NUMBER = "33645681670";
let cart = [];
let userAddress = "";
let deliveryTime = "D√®s que possible";

function showToast(text) {
    const t = document.getElementById("toast");
    t.innerHTML = `<span>${text}</span>`; // Encapsul√© pour le centrage
    t.style.transform = "translateX(-50%) translateY(0)";
    setTimeout(() => { t.style.transform = "translateX(-50%) translateY(-200%)"; }, 2000);
}

function addToCart(name, gram, price) {
    cart.push({ name, gram, price });
    if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
    showToast(`${name} ajout√© ! ‚úÖ`);
    renderApp();
}

function clearCart() { cart = []; showMenu(); }

function showMenu(){
  let cartHtml = "";
  if(cart.length > 0) {
      const totalBrut = cart.reduce((sum, i) => sum + i.price, 0);
      const reduction = totalBrut >= 100 ? 10 : 0;
      const totalFinal = totalBrut - reduction;
      const percent = Math.min((totalBrut / 100) * 100, 100);

      cartHtml = `
        <div class="cart-summary">
            <span class="promo-info">${totalBrut >= 100 ? 'üî• R√©duction -10‚Ç¨ appliqu√©e !' : `Encore <b>${100 - totalBrut}‚Ç¨</b> pour la promo`}</span>
            <div class="progress-bar"><div class="progress-fill" style="width:${percent}%"></div></div>
            
            <div style="margin-bottom:15px; max-height: 120px; overflow-y: auto;">
                ${cart.map(i => `<div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:4px;"><span>${i.name} (${i.gram})</span><span>${i.price}‚Ç¨</span></div>`).join('')}
            </div>
            
            <div style="display:flex;justify-content:space-between; font-weight:700; border-top:1px solid rgba(255,255,255,0.1); padding-top:10px; font-size:18px;">
                <span>Total</span><span>${totalFinal}‚Ç¨</span>
            </div>

            <input type="text" class="input-style" placeholder="üìç Adresse de livraison..." oninput="userAddress=this.value" value="${userAddress}">
            
            <select class="input-style" onchange="deliveryTime=this.value">
                <option value="D√®s que possible">üöÄ D√®s que possible</option>
                <option value="Ce soir (18h-20h)">üåô Ce soir (18h-20h)</option>
                <option value="Plus tard">üìÖ Plus tard (pr√©ciser en MP)</option>
            </select>

            <button class="green" onclick="orderWhatsApp()">Commander via WhatsApp</button>
            <button style="background:transparent; color:#555; font-size:11px;" onclick="clearCart()">Vider le panier</button>
        </div>`;
  }

  app.innerHTML = `
    <h1>COFFEHAZE78üèÜüöö</h1>
    <button class="yellow" onclick="showCategory('JAUNE PATATE üá≤üá¶üî•','https://i.imgur.com/tc39Nya.png',[['3g',10],['6g',20],['10g',30],['18g',50]])">JAUNE PATATE üá≤üá¶üî•</button>
    <button class="darkgreen" onclick="showCategory('BEUH STATE üá∫üá∏','https://i.imgur.com/HTKlFpX.png',[['50g',300],['100g',550]])">BEUH STATE üá∫üá∏</button>
    <button class="red" onclick="showCategory('PRODUITS PUISSANTS ü•µüîû','https://i.imgur.com/QhnxJ6E.png',[
      {name:'Frozen üî• ‚ùÑÔ∏è', prices:[['2g',20],['5g',50],['10g',90]]},
      {name:'Static ‚ö°üî•', prices:[['2g',10],['4g',20],['10g',50],['25g',100]]},
      {name:'Piatella üçØüî•', prices:[['1g',40]]}
    ])">PRODUITS PUISSANTS ü•µüîû</button>
    ${cartHtml}
  `;
}

function showCategory(title, img, items){
  let sections = '';
  if(title === "PRODUITS PUISSANTS ü•µüîû"){
    sections = items.map(item => {
      const priceBtns = item.prices.map(p => `<button class="gram-btn" onclick="addToCart('${item.name}','${p[0]}',${p[1]})"> ${p[0]} - ${p[1]}‚Ç¨</button>`).join('');
      return `<div style="margin:10px 0; background:rgba(255,255,255,0.02); padding:12px; border-radius:15px;">
                <h3 style="font-size:14px; margin:0 0 10px 0; font-weight:600;">${item.name}</h3>
                <div style="display:flex; gap:8px; flex-wrap:wrap; justify-content:center;">${priceBtns}</div>
              </div>`;
    }).join('');
  } else {
    sections = `<div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-top:15px;">
        ${items.map(g => `<button class="gram-btn" onclick="addToCart('${title}','${g[0]}',${g[1]})"> ${g[0]} - ${g[1]}‚Ç¨</button>`).join('')}
    </div>`;
  }

  app.innerHTML=`
    <h2>${title}</h2>
    <div class="product-card"><img src="${img}" alt="${title}">${sections}</div>
    <button class="gray" onclick="showMenu()">‚¨Ö Retour</button>
  `;
}

function renderApp() { if(document.querySelector('h1')) showMenu(); }

function orderWhatsApp(){
  if(cart.length === 0) return;
  if(!userAddress || userAddress.length < 5) { tg.showAlert("‚ö†Ô∏è Pr√©cise ton adresse !"); return; }
  let total = 0; let detailMessage = "";
  cart.forEach(i => { detailMessage += `- ${i.name} (${i.gram}) : ${i.price}‚Ç¨\n`; total += i.price; });
  const reduction = total >= 100 ? 10 : 0;
  const finalTotal = total - reduction;
  const message = `üöÄ *COMMANDE COFFEHAZE78*\n\nüìç *ADRESSE :* ${userAddress}\nüïí *CR√âNEAU :* ${deliveryTime}\n\nüì¶ *D√âTAILS :*\n${detailMessage}\n${reduction > 0 ? 'üéÅ *REMISE :* -10‚Ç¨\n' : ''}üí∞ *TOTAL : ${finalTotal}‚Ç¨*`;
  window.open("https://wa.me/" + WHATSAPP_NUMBER + "?text=" + encodeURIComponent(message), "_blank");
}

showMenu();
</script>
</body>
</html>
