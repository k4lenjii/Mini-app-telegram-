<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>COFFEHAZE78üèÜüöö</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
body {
  margin:0;
  min-height:100vh;
  font-family: 'Poppins', sans-serif; /* Police Smooth */
  color:white;
  display:flex;
  justify-content:center;
  align-items:center;
  background: url("https://print.marcdaviet.com/wp-content/uploads/2020/10/Noire-de-Peuterey-NB-1100x1649.jpg") no-repeat center center fixed;
  background-size: cover;
}

.app{
  width:90%;
  max-width:400px;
  background: rgba(15, 15, 15, 0.85);
  border-radius:28px;
  padding:22px;
  backdrop-filter: blur(15px);
  box-shadow: 0 15px 35px rgba(0,0,0,0.4);
  margin: 20px 0;
  border: 1px solid rgba(255,255,255,0.1);
}

h1{
  text-align:center;
  font-size:24px;
  font-weight: 700;
  margin-bottom:20px;
  letter-spacing: -0.5px;
  text-shadow: 0 2px 10px rgba(0,0,0,0.5);
}

h2{ text-align:center; color: #f1c40f; font-weight: 600; }

button{
  width:100%;
  padding:16px;
  margin:10px 0;
  border:none;
  border-radius:18px;
  font-size:16px;
  font-weight:600;
  font-family: 'Poppins', sans-serif;
  cursor:pointer;
  color:white;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes pulse {
  0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255,255,255,0.2); }
  70% { transform: scale(1.02); box-shadow: 0 0 0 10px rgba(255,255,255,0); }
  100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255,255,255,0); }
}

.yellow{ background: linear-gradient(135deg, #f1c40f, #c9a400); }
.darkgreen{ background: linear-gradient(135deg, #2ecc71, #1b5e20); }
.red{ background: linear-gradient(135deg, #e74c3c, #b71c1c); animation: pulse 2s infinite; }
.green{ background: #25D366; box-shadow: 0 8px 20px rgba(37, 211, 102, 0.3); }
.gray{ background: rgba(255,255,255,0.1); color: #ccc; }

button:active { transform: scale(0.95); }

.product-card{
  background: rgba(255,255,255,0.05);
  border-radius:22px;
  padding:15px;
  text-align:center;
  border: 1px solid rgba(255,255,255,0.08);
}

.product-card img{
  width:100%;
  border-radius:16px;
  margin-bottom:15px;
}

.product-section{
  background: rgba(255,255,255,0.03);
  margin: 10px 0;
  padding: 12px;
  border-radius: 16px;
}

.grams{ display:flex; justify-content:center; gap:10px; flex-wrap:wrap; }

.gram-btn{
  padding:10px 15px;
  border-radius:12px;
  border: 1px solid rgba(255,255,255,0.2);
  background: transparent;
  color:white;
  font-size: 14px;
  font-weight: 500;
  width: auto;
}

.cart-summary {
  background: rgba(255, 255, 255, 0.05);
  padding: 18px;
  border-radius: 22px;
  margin-top: 20px;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.address-input {
  width: 100%;
  padding: 15px;
  margin: 15px 0;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,0.2);
  background: rgba(0,0,0,0.3);
  color: white;
  box-sizing: border-box;
  font-family: 'Poppins', sans-serif;
  font-size: 14px;
}

.address-input:focus { border-color: #f1c40f; outline: none; }
</style>
</head>

<body>
<div class="app" id="app"></div>

<script>
const tg = window.Telegram.WebApp;
tg.ready();
tg.expand();

const app = document.getElementById("app");
const WHATSAPP_NUMBER = "33645681670";

let cart = [];
let userAddress = "";

function addToCart(name, gram, price) {
    cart.push({ name, gram, price });
    if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
    renderApp();
}

function clearCart() {
    cart = [];
    showMenu();
}

function showMenu(){
  let cartHtml = "";
  if(cart.length > 0) {
      const totalBrut = cart.reduce((sum, i) => sum + i.price, 0);
      const reduction = totalBrut >= 100 ? 10 : 0;
      const totalFinal = totalBrut - reduction;

      cartHtml = `
        <div class="cart-summary">
            <h3 style="margin:0 0 12px 0; font-size:18px;">üõí Panier</h3>
            <div style="margin-bottom:12px">
                ${cart.map(i => `<div style="display:flex;justify-content:space-between;font-size:14px;margin-bottom:6px;opacity:0.9;"><span>${i.name} (${i.gram})</span><span>${i.price}‚Ç¨</span></div>`).join('')}
            </div>
            ${reduction > 0 ? `<div style="color:#2ecc71; font-size:13px; margin-bottom:8px;">‚ú® R√©duction : -10‚Ç¨ appliqu√©e</div>` : ''}
            <div style="display:flex;justify-content:space-between; font-weight:700; border-top:1px solid rgba(255,255,255,0.1); padding-top:12px; font-size:18px;">
                <span>Total</span><span>${totalFinal}‚Ç¨</span>
            </div>
            
            <input type="text" class="address-input" id="addr" placeholder="Adresse de livraison..." oninput="userAddress=this.value">
            
            <button class="green" onclick="orderWhatsApp()">Commander via WhatsApp</button>
            <button style="background:transparent; color:#888; font-size:12px; text-decoration:none;" onclick="clearCart()">Vider le panier</button>
        </div>`;
  }

  app.innerHTML = `
    <h1>COFFEHAZE78üèÜüöö</h1>
    <button class="yellow" onclick="showCategory('JAUNE PATATE üá≤üá¶üî•','https://i.imgur.com/tc39Nya.png',[['3g',10],['6g',20],['10g',30],['18g',50]])">JAUNE PATATE üá≤üá¶üî•</button>
    <button class="darkgreen" onclick="showCategory('BEUH STATE üá∫üá∏','https://i.imgur.com/HTKlFpX.png',[['50g',300],['100g',550]])">BEUH STATE üá∫üá∏</button>
    <button class="red" onclick="showCategory('PRODUITS PUISSANTS ü•µüîû','https://i.imgur.com/QhnxJ6E.png',[
      {name:'Frozen Prenium üî• ‚ùÑÔ∏è', prices:[['2g',20],['5g',50],['10g',90]]},
      {name:'Static ‚ö°üî•', prices:[['2g',10],['4g',20],['10g',50],['25g',100]]},
      {name:'Piatella üçØüî•', prices:[['1g',40]]}
    ])">PRODUITS PUISSANTS ü•µüîû</button>
    <p style="font-size:11px; text-align:center; opacity:0.4; margin-top:20px;">Cadeau : -10‚Ç¨ d√®s 100‚Ç¨ d'achat</p>
    ${cartHtml}
  `;
}

function showCategory(title, img, items){
  let sections = '';
  if(title === "PRODUITS PUISSANTS ü•µüîû"){
    sections = items.map(item => {
      const priceBtns = item.prices.map(p => `<button class="gram-btn" onclick="addToCart('${item.name}','${p[0]}',${p[1]}); this.style.background='#2ecc71'; this.innerText='Pris ‚úÖ'"> ${p[0]} - ${p[1]}‚Ç¨</button>`).join('');
      return `<div class="product-section"><h3 style="font-size:16px;margin:5px 0;font-weight:600;">${item.name}</h3><div class="grams">${priceBtns}</div></div>`;
    }).join('');
  } else {
    sections = `<div class="grams" style="margin-top:15px">${items.map(g => `<button class="gram-btn" onclick="addToCart('${title}','${g[0]}',${g[1]}); this.style.background='#2ecc71'; this.innerText='Pris ‚úÖ'"> ${g[0]} - ${g[1]}‚Ç¨</button>`).join('')}</div>`;
  }

  app.innerHTML=`
    <h2 style="font-size:20px;">${title}</h2>
    <div class="product-card">
      <img src="${img}" alt="${title}">
      ${sections}
    </div>
    <button class="gray" onclick="showMenu()">‚¨Ö Retour</button>
  `;
}

function renderApp() { if(document.querySelector('h1')) showMenu(); }

function orderWhatsApp(){
  if(cart.length === 0) return;
  if(!userAddress || userAddress.length < 5) {
      alert("N'oublie pas d'indiquer ton adresse !");
      return;
  }
  
  let total = 0;
  let detailMessage = "";
  cart.forEach(i => {
      detailMessage += `- ${i.name} (${i.gram}) : ${i.price}‚Ç¨\n`;
      total += i.price;
  });

  const reduction = total >= 100 ? 10 : 0;
  const finalTotal = total - reduction;

  const message = `üöÄ Commande COFFEHAZE78\n\nüìç Adresse : ${userAddress}\n\nD√©tails :\n${detailMessage}\n${reduction > 0 ? 'üéÅ Remise : -10‚Ç¨\n' : ''}üí∞ TOTAL : ${finalTotal}‚Ç¨`;
  
  window.open("https://wa.me/" + WHATSAPP_NUMBER + "?text=" + encodeURIComponent(message), "_blank");
}

showMenu();
</script>
</body>
</html>
